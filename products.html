<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SOFRACOM • Products</title>

    <!-- Tailwind -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root{ --deep-navy:#0b2050; --sea:#0f3d72; --accent:#24b4ff; }
        html,body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
        .nav-glass{backdrop-filter:blur(10px); background:rgba(11,32,80,.55)}
        .nav-solid{background:var(--deep-navy)}
        [data-animate]{opacity:0; transform:translateY(20px); transition:all .6s ease}
        .in-view{opacity:1; transform:translateY(0)}
        .tilt{transform-style:preserve-3d; transition:transform .2s ease, box-shadow .2s ease}
        .tilt:hover{box-shadow:0 20px 45px rgba(0,0,0,.15)}
        .tilt .layer{transform:translateZ(18px)}
        .card-img{aspect-ratio:16/10; object-fit:cover}
        .price{color:#0b2050}
        .tag{background:rgba(36,180,255,.12); color:#0f3d72}
    </style>
</head>
<body class="bg-white text-gray-800 scroll-smooth">

<!-- Header / Nav -->
<header class="sticky top-0 z-40 nav-glass text-white">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-3">
        <div class="flex items-center gap-3">
            <a href="index.html" class="flex items-center gap-3">
                <img src="logo.jpeg" alt="SOFRACOM" class="h-10 w-10 rounded-lg ring-2 ring-white ring-opacity-30">
                <span class="text-xl font-extrabold tracking-wide">SOFRACOM</span>
            </a>
        </div>
        <nav class="hidden md:flex items-center gap-8 text-sm font-medium">
            <a href="index.html#home" class="hover:text-blue-200" data-i18n="nav.home">Home</a>
            <a href="index.html#about" class="hover:text-blue-200" data-i18n="nav.about">About</a>
            <a href="index.html#brands" class="hover:text-blue-200" data-i18n="nav.brands">Brands</a>
            <a href="products.html" class="hover:text-blue-200 underline" data-i18n="nav.products">Products</a>
            <a href="index.html#contact" class="hover:text-blue-200" data-i18n="nav.contact">Contact</a>
        </nav>
        <div class="flex items-center gap-3">
            <input id="searchBox" type="search" class="hidden md:block px-3 py-1.5 rounded-md bg-white bg-opacity-15 placeholder-black text-black border border-white border-opacity-20 focus:outline-none focus:ring-2 focus:ring-blue-200 w-56"
                   placeholder="Search products…">
            <select id="lang" class="px-3 py-1.5 rounded-md bg-white bg-opacity-15 text-black border border-white border-opacity-20 focus:outline-none focus:ring-2 focus:ring-blue-200">
                <option value="en">EN</option>
                <option value="fr">FR</option>
                <option value="ar">AR</option>
            </select>
        </div>
    </div>
</header>

<!-- Hero -->
<section class="relative h-64 flex items-center justify-center text-white">
    <img src="hero.jpeg" class="absolute inset-0 w-full h-full object-cover" alt="">
    <div class="absolute inset-0" style="background:linear-gradient(180deg,rgba(11,32,80,.35),rgba(11,32,80,.75))"></div>
    <div class="relative text-center px-6" data-animate>
        <h1 class="text-3xl sm:text-4xl font-extrabold" data-i18n="hero.title">Products</h1>
        <p class="text-blue-100 mt-2" data-i18n="hero.subtitle">Browse categories → open products</p>
    </div>
</section>

<main class="max-w-7xl mx-auto px-6 py-12">
    <!-- Breadcrumb / Controls -->
    <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
        <nav class="text-sm text-gray-500" id="breadcrumb">
            <a href="index.html" class="hover:underline" data-i18n="crumb.home">Home</a>
            <span class="mx-1">/</span>
            <span class="text-gray-700 font-medium" data-i18n="crumb.products">Products</span>
        </nav>

        <div class="flex items-center gap-3">
            <select id="brandFilter" class="px-3 py-2 rounded-lg border focus:ring-2 focus:ring-blue-200 hidden"></select>
            <button id="backBtn" class="px-3 py-2 rounded-lg border hidden" data-i18n="ui.back">← Back to categories</button>
        </div>
    </div>

    <!-- Categories -->
    <section id="categoriesSection">
        <h2 class="text-2xl font-extrabold mb-4" data-i18n="cats.title">Categories</h2>
        <div id="catGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <!-- Products -->
    <section id="productsSection" class="hidden">
        <div class="flex items-end justify-between gap-4">
            <div>
                <h2 id="catTitle" class="text-2xl font-extrabold"></h2>
                <p id="catDesc" class="text-gray-600 mt-1"></p>
            </div>
        </div>
        <div class="mt-6 grid sm:grid-cols-2 lg:grid-cols-3 gap-6" id="prodGrid"></div>
    </section>
</main>

<!-- Footer -->
<footer class="bg-blue-950 text-blue-100 mt-16">
    <div class="max-w-7xl mx-auto px-6 py-6 text-sm opacity-80 flex items-center justify-between">
        <span>© <span id="y"></span> SOFRACOM</span>
        <a href="#" class="hover:underline">Back to top</a>
    </div>
</footer>

<!-- Embedded demo data (used offline / file:// fallback) -->
<script id="productsData" type="application/json">
    {
        "categories": [
            {
                "name": "Antifouling & Coatings",
                "slug": "antifouling-coatings",
                "image": "assets/bosch.png",
                "description": "Bottom paints, primers, and topcoats for local waters.",
                "products": [
                    {"title":"Jotun SeaForce 30","image":"assets/bosch.png","description":"Self-polishing antifouling for sailing yachts and motorboats.","brand":"JOTUN","usage":["Antifouling","Warm waters","Self-polishing"],"price":380},
                    {"title":"Hempel Mille NCT","image":"assets/bosch.png","description":"High-performance antifouling with advanced binder.","brand":"HEMPEL","usage":["Antifouling","Long-lasting","Easy apply"],"price":420}
                ]
            },
            {
                "name": "Sealants & Adhesives",
                "slug": "sealants-adhesives",
                "image": "assets/bosch.png",
                "description": "Marine sealants for deck hardware, teak, hatches, and glazing.",
                "products": [
                    {"title":"Sika 291i","image":"assets/bosch.png","description":"Multi-purpose marine sealant/adhesive for general use.","brand":"SIKA","usage":["Deck hardware","General bonding","Flexible"],"price":65},
                    {"title":"Sika 295 UV","image":"assets/bosch.png","description":"UV-resistant adhesive for organic glass (PMMA/PC).","brand":"SIKA","usage":["Windows","UV-resistant","Elastic"],"price":89}
                ]
            },
            {
                "name": "Oils, Filters & Batteries",
                "slug": "oils-filters-batteries",
                "image": "assets/bosch.png",
                "description": "Engine oils, filters and reliable onboard power.",
                "products": [
                    {"title":"Shell Rimula R4 15W-40","image":"assets/bosch.png","description":"Heavy-duty engine oil for marine diesel.","brand":"SHELL","usage":["Engine","Protection"],"price":120},
                    {"title":"VARTA Blue Dynamic 75Ah","image":"assets/bosch.png","description":"Marine battery with strong cold cranking performance.","brand":"VARTA","usage":["Battery","Electrical"],"price":780}
                ]
            }
        ]
    }
</script>

<script>
    // Sticky header solid on scroll
    const header = document.querySelector('header');
    addEventListener('scroll', () => {
        if (scrollY > 40) header.classList.add('nav-solid'); else header.classList.remove('nav-solid');
    });
    document.getElementById('y').textContent = new Date().getFullYear();

    // Intersection reveal
    const io = new IntersectionObserver((es)=> es.forEach(e=>{ if(e.isIntersecting){e.target.classList.add('in-view'); io.unobserve(e.target);} }), {threshold:.15});
    document.querySelectorAll('[data-animate]').forEach(el=>io.observe(el));

    // Tilt
    function tiltify(card){
        const r=12;
        function move(e){ const b=card.getBoundingClientRect(), px=(e.clientX-b.left)/b.width, py=(e.clientY-b.top)/b.height; card.style.transform=`rotateX(${(0.5-py)*r}deg) rotateY(${(px-0.5)*r}deg)`;}
        function reset(){ card.style.transform='rotateX(0) rotateY(0)';}
        card.addEventListener('mousemove',move); card.addEventListener('mouseleave',reset);
    }

    // ==== Data load (fetch + fallback to embedded JSON for file://) ====
    const DATA_URL = './assets/data/products.json';
    const catGrid = document.getElementById('catGrid');
    const prodGrid = document.getElementById('prodGrid');
    const categoriesSection = document.getElementById('categoriesSection');
    const productsSection = document.getElementById('productsSection');
    const backBtn = document.getElementById('backBtn');
    const brandFilter = document.getElementById('brandFilter');
    const searchBox = document.getElementById('searchBox');
    const catTitle = document.getElementById('catTitle');
    const catDesc = document.getElementById('catDesc');
    const breadcrumb = document.getElementById('breadcrumb');
    const langSel = document.getElementById('lang');

    let STORE = null, activeCat = null, filtered = [];

    function getEmbeddedJSON(){
        try { const el = document.getElementById('productsData'); return el ? JSON.parse(el.textContent) : null; }
        catch(e){ return null; }
    }

    (async () => {
        try {
            const r = await fetch(DATA_URL, {cache:'no-cache'});
            if (!r.ok) throw new Error('HTTP '+r.status);
            STORE = await r.json();
        } catch (e) {
            STORE = getEmbeddedJSON();
            if (!STORE){
                catGrid.innerHTML = `<div class="text-red-600">Failed to load products data.</div>`;
                console.error(e);
                return;
            }
        }
        renderCategories(STORE.categories);
        const p = new URLSearchParams(location.search);
        const slug = p.get('cat'); if (slug) openCategory(slug);
        applyLang((localStorage.getItem('lang')||'en')); // sync i18n once data is drawn
    })();

    function slugify(s){return s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');}

    function renderCategories(cats){
        categoriesSection.classList.remove('hidden');
        productsSection.classList.add('hidden');
        backBtn.classList.add('hidden'); brandFilter.classList.add('hidden'); searchBox.classList.add('hidden');

        breadcrumb.innerHTML = `<a href="index.html" class="hover:underline" data-i18n="crumb.home">Home</a> <span class="mx-1">/</span> <span class="text-gray-700 font-medium" data-i18n="crumb.products">Products</span>`;

        catGrid.innerHTML = cats.map(c => {
            const s = c.slug || slugify(c.name);
            const img = c.image || 'assets/placeholder-cat.jpg';
            return `
        <button data-cat="${s}" class="tilt group text-left bg-white rounded-2xl overflow-hidden shadow hover:shadow-xl transform transition">
          <div class="layer">
            <img src="${img}" alt="${c.name}" class="card-img w-full">
            <div class="p-4">
              <h3 class="text-lg font-semibold text-gray-900 group-hover:text-blue-900">${c.name}</h3>
              ${c.description ? `<p class="text-sm text-gray-600 mt-1">${c.description}</p>`:''}
            </div>
          </div>
        </button>`;
        }).join('');
        catGrid.querySelectorAll('.tilt').forEach(tiltify);
        catGrid.querySelectorAll('[data-cat]').forEach(btn => btn.addEventListener('click', () => openCategory(btn.dataset.cat)));
    }

    function openCategory(slug){
        const cat = STORE.categories.find(c => (c.slug || slugify(c.name)) === slug);
        if (!cat){ alert('Category not found'); return; }
        activeCat = cat;

        categoriesSection.classList.add('hidden');
        productsSection.classList.remove('hidden');
        backBtn.classList.remove('hidden'); brandFilter.classList.remove('hidden'); searchBox.classList.remove('hidden');

        breadcrumb.innerHTML = `<a href="index.html" class="hover:underline" data-i18n="crumb.home">Home</a> <span class="mx-1">/</span>
                            <a href="products.html" class="hover:underline" data-i18n="crumb.products">Products</a> <span class="mx-1">/</span>
                            <span class="text-gray-700 font-medium">${cat.name}</span>`;

        catTitle.textContent = cat.name;
        catDesc.textContent = cat.description || '';

        const brands = Array.from(new Set(cat.products.map(p=>p.brand).filter(Boolean))).sort();
        brandFilter.innerHTML = `<option value="">All brands</option>` + brands.map(b=>`<option>${b}</option>`).join('');

        filtered = cat.products.slice();
        searchBox.value=''; brandFilter.value='';
        renderProducts();
        history.replaceState(null,'',`?cat=${encodeURIComponent(cat.slug || slugify(cat.name))}`);
    }

    function renderProducts(){
        const list = filtered;
        if (!list.length){
            prodGrid.innerHTML = `<div class="col-span-full text-gray-500" data-i18n="ui.none">No products found.</div>`;
            return;
        }
        prodGrid.innerHTML = list.map(p => productCard(p)).join('');
        prodGrid.querySelectorAll('.tilt').forEach(tiltify);
    }

    function productCard(p){
        const img = p.image || 'assets/placeholder-prod.jpg';
        const usage = Array.isArray(p.usage) ? p.usage.map(u=>`<span class="px-2 py-1 rounded tag text-xs">${u}</span>`).join(' ') : '';
        const price = (p.price!=null) ? `<div class="mt-3 font-bold price">${formatPrice(p.price)}</div>` : '';
        return `
      <article class="tilt bg-white rounded-2xl overflow-hidden shadow hover:shadow-xl transform transition">
        <div class="layer">
          <img src="${img}" alt="${p.title}" class="card-img w-full">
          <div class="p-4">
            <h3 class="text-lg font-semibold text-gray-900">${p.title}</h3>
            <p class="text-sm text-gray-600 mt-1">${p.description||''}</p>
            <div class="mt-2 text-xs text-gray-500"><span data-i18n="ui.brand">Brand</span>: <b>${p.brand||'—'}</b></div>
            <div class="mt-3 flex flex-wrap gap-2">${usage}</div>
            ${price}
          </div>
        </div>
      </article>`;
    }

    function formatPrice(v){
        try { return new Intl.NumberFormat('fr-TN',{style:'currency',currency:'TND'}).format(v); }
        catch(e){ return v + ' TND'; }
    }

    // Filters
    brandFilter.addEventListener('change', applyFilters);
    searchBox.addEventListener('input', debounce(applyFilters, 120));
    backBtn.addEventListener('click', ()=>{ history.replaceState(null,'','products.html'); renderCategories(STORE.categories); applyLang((localStorage.getItem('lang')||'en')); });

    function applyFilters(){
        const q = (searchBox.value||'').toLowerCase();
        const b = brandFilter.value||'';
        let list = activeCat.products.slice();
        if (b) list = list.filter(p=> (p.brand||'').toLowerCase() === b.toLowerCase());
        if (q) list = list.filter(p =>
            (p.title||'').toLowerCase().includes(q) ||
            (p.description||'').toLowerCase().includes(q) ||
            (p.brand||'').toLowerCase().includes(q) ||
            (Array.isArray(p.usage) ? p.usage.join(' ').toLowerCase().includes(q) : false)
        );
        filtered = list;
        renderProducts();
    }

    function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }

    // ======= i18n (EN/FR/AR + RTL) =======
    const I18N = {
        en:{
            'nav.home':'Home','nav.about':'About','nav.brands':'Brands','nav.products':'Products','nav.contact':'Contact',
            'hero.title':'Products','hero.subtitle':'Browse categories → open products',
            'crumb.home':'Home','crumb.products':'Products',
            'cats.title':'Categories','ui.back':'← Back to categories','ui.allBrands':'All brands','ui.none':'No products found.','ui.brand':'Brand',
            'ui.search':'Search products…'
        },
        fr:{
            'nav.home':'Accueil','nav.about':'À propos','nav.brands':'Marques','nav.products':'Produits','nav.contact':'Contact',
            'hero.title':'Produits','hero.subtitle':'Parcourez les catégories → ouvrez les produits',
            'crumb.home':'Accueil','crumb.products':'Produits',
            'cats.title':'Catégories','ui.back':'← Retour aux catégories','ui.allBrands':'Toutes les marques','ui.none':'Aucun produit trouvé.','ui.brand':'Marque',
            'ui.search':'Rechercher des produits…'
        },
        ar:{
            'nav.home':'الرئيسية','nav.about':'من نحن','nav.brands':'العلامات','nav.products':'المنتجات','nav.contact':'اتصل بنا',
            'hero.title':'المنتجات','hero.subtitle':'تصفح الفئات ← فتح المنتجات',
            'crumb.home':'الرئيسية','crumb.products':'المنتجات',
            'cats.title':'الفئات','ui.back':'← عودة إلى الفئات','ui.allBrands':'كل العلامات','ui.none':'لا توجد منتجات.','ui.brand':'العلامة',
            'ui.search':'ابحث في المنتجات…'
        }
    };

    function applyLang(lang){
        const d = I18N[lang] || I18N.en;

        // nav & hero
        document.querySelectorAll('[data-i18n]').forEach(el=>{
            const k = el.getAttribute('data-i18n');
            if(d[k]) el.textContent = d[k];
        });

        // breadcrumb (explicit HTML)
        const crumb = document.getElementById('breadcrumb');
        if(crumb){
            crumb.innerHTML = `<a href="index.html" class="hover:underline" data-i18n="crumb.home">${d['crumb.home']}</a>
                         <span class="mx-1">/</span>
                         <span class="text-gray-700 font-medium" data-i18n="crumb.products">${d['crumb.products']}</span>`;
        }

        // inputs
        if (searchBox) searchBox.placeholder = d['ui.search'];
        if (brandFilter && brandFilter.options.length) brandFilter.options[0].textContent = d['ui.allBrands'];
        if (backBtn) backBtn.textContent = d['ui.back'];

        // empty state update if present
        const empty = document.querySelector('#prodGrid .col-span-full');
        if (empty) empty.textContent = d['ui.none'];

        // dir
        document.documentElement.lang = lang;
        document.documentElement.dir = (lang==='ar') ? 'rtl' : 'ltr';

        try{ localStorage.setItem('lang', lang);}catch(e){}
    }

    // sync i18n on language change
    const savedLang = (typeof localStorage!=='undefined' && localStorage.getItem('lang')) || 'en';
    langSel.value = savedLang;
    langSel.addEventListener('change', e=>{
        applyLang(e.target.value);
    });

    // initial apply (after initial DOM is present)
    applyLang(savedLang);
</script>
</body>
</html>