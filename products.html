<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SOFRACOM • Products</title>

    <!-- Tailwind -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root{
            --deep-navy:#0b2050; --sea:#0f3d72; --accent:#24b4ff;
        }
        html,body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
        .nav-glass{backdrop-filter:blur(10px); background:rgba(11,32,80,.55)}
        .nav-solid{background:var(--deep-navy)}
        [data-animate]{opacity:0; transform:translateY(20px); transition:all .6s ease}
        .in-view{opacity:1; transform:translateY(0)}
        .tilt{transform-style:preserve-3d; transition:transform .2s ease, box-shadow .2s ease}
        .tilt:hover{box-shadow:0 20px 45px rgba(0,0,0,.15)}
        .tilt .layer{transform:translateZ(18px)}
        .card-img{aspect-ratio: 16/10; object-fit:cover}
        .price{color:#0b2050}
        .tag{background:rgba(36,180,255,.12); color:#0f3d72}
    </style>
</head>
<body class="bg-white text-gray-800 scroll-smooth">

<!-- Header / Nav -->
<header class="sticky top-0 z-40 nav-glass text-white">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-3">
        <div class="flex items-center gap-3">
            <a href="index.html" class="flex items-center gap-3">
                <img src="logo.jpeg" alt="SOFRACOM" class="h-10 w-10 rounded-lg ring-2 ring-white ring-opacity-30">
                <span class="text-xl font-extrabold tracking-wide">SOFRACOM</span>
            </a>
        </div>
        <nav class="hidden md:flex items-center gap-8 text-sm font-medium">
            <a href="index.html#home" class="hover:text-blue-200">Home</a>
            <a href="index.html#about" class="hover:text-blue-200">About</a>
            <a href="index.html#brands" class="hover:text-blue-200">Brands</a>
            <a href="products.html" class="hover:text-blue-200 underline">Products</a>
            <a href="index.html#contact" class="hover:text-blue-200">Contact</a>
        </nav>
    </div>
</header>

<!-- Hero -->
<section class="relative h-64 flex items-center justify-center text-white">
    <img src="hero.jpeg" class="absolute inset-0 w-full h-full object-cover" alt="">
    <div class="absolute inset-0" style="background:linear-gradient(180deg,rgba(11,32,80,.35),rgba(11,32,80,.75))"></div>
    <div class="relative text-center px-6" data-animate>
        <h1 class="text-3xl sm:text-4xl font-extrabold">Products</h1>
        <p class="text-blue-100 mt-2">Browse categories → open products</p>
    </div>
</section>

<main class="max-w-7xl mx-auto px-6 py-12">

    <!-- Breadcrumb / Controls -->
    <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
        <nav class="text-sm text-gray-500" id="breadcrumb">
            <a href="index.html" class="hover:underline">Home</a> <span class="mx-1">/</span>
            <span class="text-gray-700 font-medium">Products</span>
        </nav>

        <div class="flex items-center gap-3">
            <input id="searchBox" type="search" placeholder="Search products…" class="px-3 py-2 rounded-lg border focus:ring-2 focus:ring-blue-200 w-64 hidden" />
            <select id="brandFilter" class="px-3 py-2 rounded-lg border focus:ring-2 focus:ring-blue-200 hidden"></select>
            <button id="backBtn" class="px-3 py-2 rounded-lg border hidden">← Back to categories</button>
        </div>
    </div>

    <!-- Categories grid -->
    <section id="categoriesSection">
        <h2 class="text-2xl font-extrabold mb-4">Categories</h2>
        <div id="catGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <!-- Products grid (hidden until a category is opened) -->
    <section id="productsSection" class="hidden">
        <div class="flex items-end justify-between gap-4">
            <div>
                <h2 id="catTitle" class="text-2xl font-extrabold"></h2>
                <p id="catDesc" class="text-gray-600 mt-1"></p>
            </div>
        </div>

        <div class="mt-6 grid sm:grid-cols-2 lg:grid-cols-3 gap-6" id="prodGrid"></div>
    </section>
</main>

<!-- Footer (simple) -->
<footer class="bg-blue-950 text-blue-100 mt-16">
    <div class="max-w-7xl mx-auto px-6 py-6 text-sm opacity-80 flex items-center justify-between">
        <span>© <span id="y"></span> SOFRACOM</span>
        <a href="#" class="hover:underline">Back to top</a>
    </div>
</footer>

<script>
    // Sticky header solid on scroll
    const header = document.querySelector('header');
    addEventListener('scroll', () => {
        if (scrollY > 40) header.classList.add('nav-solid'); else header.classList.remove('nav-solid');
    });

    // Intersection reveal
    const io = new IntersectionObserver((es)=> es.forEach(e=>{ if(e.isIntersecting){e.target.classList.add('in-view'); io.unobserve(e.target);} }), {threshold:.15});
    document.querySelectorAll('[data-animate]').forEach(el=>io.observe(el));
    document.getElementById('y').textContent = new Date().getFullYear();

    // Tilt
    function tiltify(card){
        const r=12;
        function move(e){ const b=card.getBoundingClientRect(), px=(e.clientX-b.left)/b.width, py=(e.clientY-b.top)/b.height; card.style.transform=`rotateX(${(0.5-py)*r}deg) rotateY(${(px-0.5)*r}deg)`;}
        function reset(){ card.style.transform='rotateX(0) rotateY(0)';}
        card.addEventListener('mousemove',move); card.addEventListener('mouseleave',reset);
    }

    // Data
    const DATA_URL = './assets/data/products.json';

    // DOM
    const catGrid = document.getElementById('catGrid');
    const prodGrid = document.getElementById('prodGrid');
    const categoriesSection = document.getElementById('categoriesSection');
    const productsSection = document.getElementById('productsSection');
    const backBtn = document.getElementById('backBtn');
    const brandFilter = document.getElementById('brandFilter');
    const searchBox = document.getElementById('searchBox');
    const catTitle = document.getElementById('catTitle');
    const catDesc = document.getElementById('catDesc');
    const breadcrumb = document.getElementById('breadcrumb');

    let STORE = null;
    let activeCat = null;
    let filtered = [];

    fetch(DATA_URL)
        .then(r=>r.json())
        .then(json => {
            STORE = json;
            renderCategories(STORE.categories);
            // deep-link: ?cat=slug
            const p = new URLSearchParams(location.search);
            const slug = p.get('cat');
            if (slug) openCategory(slug);
        })
        .catch(err => {
            catGrid.innerHTML = `<div class="text-red-600">Failed to load products.json</div>`;
            console.error(err);
        });

    function slugify(s){return s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');}

    function renderCategories(cats){
        categoriesSection.classList.remove('hidden');
        productsSection.classList.add('hidden');
        backBtn.classList.add('hidden'); brandFilter.classList.add('hidden'); searchBox.classList.add('hidden');

        breadcrumb.innerHTML = `<a href="index.html" class="hover:underline">Home</a> <span class="mx-1">/</span> <span class="text-gray-700 font-medium">Products</span>`;

        catGrid.innerHTML = cats.map(c => {
            const s = c.slug || slugify(c.name);
            const img = c.image || 'assets/placeholder-cat.jpg';
            return `
        <button data-cat="${s}" class="tilt group text-left bg-white rounded-2xl overflow-hidden shadow hover:shadow-xl transform transition">
          <div class="layer">
            <img src="${img}" alt="${c.name}" class="card-img w-full">
            <div class="p-4">
              <h3 class="text-lg font-semibold text-gray-900 group-hover:text-blue-900">${c.name}</h3>
              ${c.description ? `<p class="text-sm text-gray-600 mt-1">${c.description}</p>`:''}
            </div>
          </div>
        </button>`;
        }).join('');
        catGrid.querySelectorAll('.tilt').forEach(tiltify);
        catGrid.querySelectorAll('[data-cat]').forEach(btn => btn.addEventListener('click', () => openCategory(btn.dataset.cat)));
    }

    function openCategory(slug){
        const cat = STORE.categories.find(c => (c.slug || slugify(c.name)) === slug);
        if (!cat){ alert('Category not found'); return; }
        activeCat = cat;

        // UI
        categoriesSection.classList.add('hidden');
        productsSection.classList.remove('hidden');
        backBtn.classList.remove('hidden'); brandFilter.classList.remove('hidden'); searchBox.classList.remove('hidden');

        // Breadcrumb
        breadcrumb.innerHTML = `<a href="index.html" class="hover:underline">Home</a> <span class="mx-1">/</span>
                            <a href="products.html" class="hover:underline">Products</a> <span class="mx-1">/</span>
                            <span class="text-gray-700 font-medium">${cat.name}</span>`;

        catTitle.textContent = cat.name;
        catDesc.textContent = cat.description || '';

        // Build brand filter
        const brands = Array.from(new Set(cat.products.map(p=>p.brand).filter(Boolean))).sort();
        brandFilter.innerHTML = `<option value="">All brands</option>` + brands.map(b=>`<option>${b}</option>`).join('');

        // Render
        filtered = cat.products.slice();
        searchBox.value=''; brandFilter.value='';
        renderProducts();
        history.replaceState(null,'',`?cat=${encodeURIComponent(cat.slug || slugify(cat.name))}`);
    }

    function renderProducts(){
        const list = filtered;
        if (!list.length){
            prodGrid.innerHTML = `<div class="col-span-full text-gray-500">No products found.</div>`;
            return;
        }
        prodGrid.innerHTML = list.map(p => productCard(p)).join('');
        prodGrid.querySelectorAll('.tilt').forEach(tiltify);
    }

    function productCard(p){
        const img = p.image || 'assets/placeholder-prod.jpg';
        const usage = Array.isArray(p.usage) ? p.usage.map(u=>`<span class="px-2 py-1 rounded tag text-xs">${u}</span>`).join(' ') : '';
        const price = (p.price!=null) ? `<div class="mt-3 font-bold price">${formatPrice(p.price)}</div>` : '';
        return `
    <article class="tilt bg-white rounded-2xl overflow-hidden shadow hover:shadow-xl transform transition">
      <div class="layer">
        <img src="${img}" alt="${p.title}" class="card-img w-full">
        <div class="p-4">
          <h3 class="text-lg font-semibold text-gray-900">${p.title}</h3>
          <p class="text-sm text-gray-600 mt-1">${p.description||''}</p>
          <div class="mt-2 text-xs text-gray-500">Brand: <b>${p.brand||'—'}</b></div>
          <div class="mt-3 flex flex-wrap gap-2">${usage}</div>
          ${price}
        </div>
      </div>
    </article>`;
    }

    function formatPrice(v){
        // TND formatting (override as needed)
        try { return new Intl.NumberFormat('fr-TN',{style:'currency',currency:'TND'}).format(v); }
        catch(e){ return v + ' TND'; }
    }

    // Filters
    brandFilter.addEventListener('change', applyFilters);
    searchBox.addEventListener('input', debounce(applyFilters, 120));
    backBtn.addEventListener('click', ()=>{ history.replaceState(null,'','products.html'); renderCategories(STORE.categories); });

    function applyFilters(){
        const q = (searchBox.value||'').toLowerCase();
        const b = brandFilter.value||'';
        let list = activeCat.products.slice();
        if (b) list = list.filter(p=> (p.brand||'').toLowerCase() === b.toLowerCase());
        if (q) list = list.filter(p =>
            (p.title||'').toLowerCase().includes(q) ||
            (p.description||'').toLowerCase().includes(q) ||
            (p.brand||'').toLowerCase().includes(q) ||
            (Array.isArray(p.usage) ? p.usage.join(' ').toLowerCase().includes(q) : false)
        );
        filtered = list;
        renderProducts();
    }

    function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }
</script>
</body>
</html>