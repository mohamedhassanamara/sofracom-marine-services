module.exports=[2734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},4747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},4799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},3450,(e,t,r)=>{let{randomUUID:o}=e.r(4799),{getFirebaseApp:s}=e.r(1995);async function a(e){return e.body&&"object"==typeof e.body?e.body:new Promise((t,r)=>{let o="";e.on("data",t=>{(o+=t.toString()).length>1e6&&(r(Error("Payload too large")),e.destroy())}),e.on("end",()=>{try{t(o?JSON.parse(o):{})}catch{r(Error("Invalid JSON payload"))}}),e.on("error",r)})}t.exports=async function(e,t){let r;if(t.setHeader("Content-Type","application/json"),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","POST, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type"),"OPTIONS"===e.method)return void t.status(204).end();if("POST"!==e.method){t.setHeader("Allow","POST, OPTIONS"),t.status(405).json({ok:!1,error:"Method not allowed"});return}try{r=await a(e)}catch(e){t.status(400).json({ok:!1,error:e.message});return}let n=function(e){let t=[];if(!e||"object"!=typeof e)return["Missing request body"];(Array.isArray(e.items)?e.items:[]).length||t.push("Cart is empty");let r=e.customer||{};return(!r.name||String(r.name).trim().length<2)&&t.push("Name is required"),(!r.phone||String(r.phone).trim().length<6)&&t.push("Phone is required"),(!r.address||String(r.address).trim().length<6)&&t.push("Address is required"),t}(r);if(n.length)return void t.status(400).json({ok:!1,error:n.join(", ")});let i=o(),l={id:i,created_at:new Date().toISOString(),customer_name:r.customer.name.trim(),customer_phone:r.customer.phone.trim(),customer_address:r.customer.address.trim(),customer_notes:(r.customer.notes||"").trim(),items:r.items,total:Number.isFinite(r.total)?r.total:0,currency:r.currency||"TND",status:"new"};try{let e=s().firestore();await e.collection("orders").doc(i).set(l);try{let e=s().messaging(),t=Number.isFinite(l.total)?new Intl.NumberFormat("fr-TN",{style:"currency",currency:l.currency||"TND"}).format(l.total):`${l.total||0} ${l.currency||"TND"}`;await e.send({topic:"sofracom-orders",notification:{title:`New order from ${l.customer_name}`,body:`${l.items.length} item(s) \xb7 ${t}`},data:{orderId:i,customerName:l.customer_name,total:String(l.total??0),currency:l.currency||"TND"}})}catch(e){console.warn("[order] FCM notify failed",e)}t.status(200).json({ok:!0,orderId:i,persisted:!0})}catch(e){console.error("[order] persistence failed",e),t.status(500).json({ok:!1,error:e.message||"Unable to store order"})}}},483,e=>{"use strict";var t=e.i(6747),r=e.i(9245),o=e.i(4898),s=e.i(2950),a=e.i(3450),n=e.i(7031),i=e.i(1927),l=e.i(6432);let d=(0,s.hoist)(a,"default"),u=(0,s.hoist)(a,"config"),c=new o.PagesAPIRouteModule({definition:{kind:r.RouteKind.PAGES_API,page:"/api/create-order",pathname:"/api/create-order",bundlePath:"",filename:""},userland:a,distDir:".next",relativeProjectDir:""});async function p(e,r,o){c.isDev&&(0,l.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/create-order";s=s.replace(/\/index$/,"")||"/";let a=await c.prepare(e,r,{srcPage:s});if(!a){r.statusCode=400,r.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve());return}let{query:d,params:u,prerenderManifest:p,routerServerContext:m}=a;try{let t=e.method||"GET",o=(0,n.getTracer)(),a=o.getActiveScopeSpan(),l=c.instrumentationOnRequestError.bind(c),h=async a=>c.render(e,r,{query:{...d,...u},params:u,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:p.preview,propagateError:!1,dev:c.isDev,page:"/api/create-order",internalRevalidate:null==m?void 0:m.revalidate,onError:(...t)=>l(e,...t)}).finally(()=>{if(!a)return;a.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let e=o.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=e.get("next.route");if(n){let e=`${t} ${n}`;a.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),a.updateName(e)}else a.updateName(`${t} ${s}`)});a?await h(a):await o.withPropagatedContext(e.headers,()=>o.trace(i.BaseServerSpan.handleRequest,{spanName:`${t} ${s}`,kind:n.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},h))}catch(e){if(c.isDev)throw e;(0,t.sendError)(r,500,"Internal Server Error")}finally{null==o.waitUntil||o.waitUntil.call(o,Promise.resolve())}}e.s(["config",0,u,"default",0,d,"handler",()=>p])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__78865383._.js.map